{% extends "base.html" %}

{% block title %}Review Queue - PuntyAI{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Review Queue</h1>
            <p class="text-gray-500">Content awaiting your approval</p>
        </div>
        <div class="flex items-center gap-3">
            <span class="text-sm text-gray-500">{{ review_items|length }} item(s) pending</span>
            {% if review_items %}
            <button hx-post="/api/content/reject-all-pending"
                    hx-confirm="Reject all {{ review_items|length }} pending item(s)?"
                    hx-swap="none"
                    hx-on::after-request="if(event.detail.successful) { location.reload(); } else showToast('Failed', 'error');"
                    class="px-3 py-1.5 text-sm border border-red-300 text-red-600 rounded-lg hover:bg-red-50">
                Reject All
            </button>
            {% endif %}
        </div>
    </div>

    {% if review_items %}
    <!-- Review List -->
    <div class="space-y-4">
        {% for item in review_items %}
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">
                        {{ item.content_type|replace('_', ' ')|title }}
                    </h3>
                    <p class="text-sm text-gray-500">
                        {{ item.meeting_id }} | Created {{ item.created_at|melb('%d %b at %H:%M') }}
                    </p>
                </div>
                <a href="/review/{{ item.id }}"
                   class="bg-punty-coral text-white px-4 py-2 rounded-lg hover:bg-punty-coral/90">
                    Review
                </a>
            </div>
            <div class="px-6 py-4">
                <div class="prose prose-sm max-w-none">
                    <pre class="whitespace-pre-wrap bg-gray-50 p-4 rounded text-sm">{{ item.raw_content or 'No content yet' }}</pre>
                </div>
            </div>
            <div class="px-6 py-3 bg-gray-50 flex justify-end space-x-3">
                <button hx-post="/api/content/{{ item.id }}/review"
                        hx-ext="json-enc"
                        hx-vals='{"action": "reject", "notes": "Quick reject from queue"}'
                        hx-confirm="Reject this content? Picks will be deleted."
                        hx-swap="none"
                        hx-on::after-request="if(event.detail.successful) { this.closest('div.bg-white').remove(); showToast('Rejected', 'info'); } else showToast('Failed', 'error');"
                        class="px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50">
                    Reject
                </button>
                <button hx-post="/api/content/{{ item.id }}/review"
                        hx-ext="json-enc"
                        hx-vals='{"action": "approve"}'
                        hx-swap="none"
                        hx-on::after-request="if(event.detail.successful) { this.closest('div.bg-white').remove(); showToast('Approved!', 'success'); } else showToast('Failed', 'error');"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    Approve
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-6xl mb-4">&#x1F389;</p>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">All caught up!</h2>
        <p class="text-gray-500 mb-6">No content is waiting for your review</p>
        <div class="flex justify-center space-x-4">
            <a href="/meets" class="text-punty-coral hover:underline">View meetings</a>
            <span class="text-gray-300">|</span>
            <a href="/content" class="text-punty-coral hover:underline">View all content</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
