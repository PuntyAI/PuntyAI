{# Sequence Bets — all quaddies, big6 etc. compact format, ordered by up next #}
{% if sequences|default([])|length > 0 %}
<div>
    {% if not hide_heading|default(false) %}
    <h2 class="section-heading">
        <svg class="w-5 h-5" style="color: var(--orange);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
        Sequence Bets
    </h2>
    {% endif %}
    <div class="space-y-2">
        {% for seq in sequences %}
        <div class="card px-4 py-3" style="border-color: rgba(255, 107, 53, 0.2);">
            {# Header row: venue, type badge, countdown, combos, link #}
            <div class="flex items-center gap-2 mb-1.5">
                <span class="font-heading font-bold text-white text-sm">{{ seq.venue }}</span>
                <span class="type-badge" style="background: rgba(255, 107, 53, 0.15); color: var(--orange);">{{ seq.type }}{% if seq.variant %} {{ seq.variant }}{% endif %}</span>
                {% if seq.first_leg_time %}
                <span class="text-xs font-heading font-semibold seq-countdown" data-start="{{ seq.first_leg_time }}" style="color: var(--yellow);">
                    R{{ seq.first_leg_race }}
                </span>
                {% endif %}
                <span class="text-xs ml-auto flex-shrink-0" style="color: var(--text-muted);">{{ seq.combo_count }} combos{% if seq.stake %} &middot; ${{ '%.0f'|format(seq.stake) }}{% endif %}</span>
                <a href="/tips/{{ seq.meeting_id }}" class="flex-shrink-0 text-xs font-heading font-bold uppercase tracking-wider transition-colors" style="color: var(--orange);">Card &rarr;</a>
            </div>
            {# Legs: R5: 3,9,6 | R6: 15,5,14 | ... #}
            <div class="flex items-center gap-1 flex-wrap text-xs">
                {% for leg in seq.legs %}
                {% if not loop.first %}<span style="color: rgba(255,255,255,0.15);">|</span>{% endif %}
                <span>
                    <span class="font-heading font-bold" style="color: var(--text-muted);">R{{ leg.race }}:</span>
                    <span class="font-heading font-semibold text-white">{{ leg.runners|join(', ') }}</span>
                </span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>
// Sequence countdown timers — minutes only, no seconds (avoids flashing)
(function() {
    function updateSeqCountdowns() {
        document.querySelectorAll('.seq-countdown').forEach(function(el) {
            var start = el.getAttribute('data-start');
            if (!start) return;
            var mins = Math.ceil((new Date(start) - new Date()) / 60000);
            if (mins <= 0) {
                el.textContent = 'LIVE';
                el.style.color = 'var(--magenta)';
            } else if (mins >= 60) {
                var h = Math.floor(mins / 60);
                var m = mins % 60;
                el.textContent = h + 'h ' + m + 'm';
            } else {
                el.textContent = mins + 'm';
            }
        });
    }
    updateSeqCountdowns();
    setInterval(updateSeqCountdowns, 60000);
})();
</script>
{% endif %}
