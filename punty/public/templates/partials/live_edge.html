{# Live Edge Zone â€” HTMX-pollable partial for dashboard #}
{% if primary_play and next_race and next_race.has_next %}
<div class="card p-6 relative overflow-hidden" style="border-color: rgba(233, 30, 140, 0.3); background: linear-gradient(135deg, rgba(233, 30, 140, 0.05), rgba(255, 107, 53, 0.03));">
    {# Header #}
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-heading font-bold uppercase tracking-wider"
                  style="background: rgba(233, 30, 140, 0.15); color: var(--magenta); border: 1px solid rgba(233, 30, 140, 0.3);">
                <span style="width: 6px; height: 6px; border-radius: 50%; background: var(--magenta); display: inline-block; animation: live-dot 1.5s ease-in-out infinite;"></span>
                Live Edge Zone
            </span>
        </div>
        <div class="text-right">
            <div class="countdown-fixed font-display font-bold text-lg" style="color: var(--magenta);" data-start="{{ next_race.start_time_iso }}">--:--</div>
            <div class="text-xs" style="color: var(--text-muted);">until jump</div>
        </div>
    </div>

    {# Race info #}
    <div class="text-xs font-heading font-semibold uppercase tracking-wider mb-3" style="color: var(--text-muted);">
        {{ next_race.venue }} &mdash; R{{ next_race.race_number }}
        {% if next_race.distance %} &middot; {{ next_race.distance }}m{% endif %}
        {% if next_race.class %} &middot; {{ next_race.class }}{% endif %}
    </div>

    {# Primary Play Card #}
    <div class="p-4 rounded-xl mb-4" style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-subtle);">
        <div class="flex items-start justify-between mb-3">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg font-display font-bold text-sm text-white" style="background: var(--gradient-sunset);">{{ primary_play.saddlecloth or '#' }}</span>
                    <span class="font-display font-bold text-xl text-white">{{ primary_play.name }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm font-heading font-bold uppercase" style="color: var(--cyan);">{{ primary_play.bet_type }}</span>
                    <span class="text-sm font-heading font-bold" style="color: var(--text-primary);">${{ '%.2f'|format(primary_play.odds) }}</span>
                </div>
            </div>
            {# Confidence Badge #}
            {% set badge_color = 'var(--magenta)' if primary_play.confidence == 'HIGH EDGE' else ('var(--orange)' if primary_play.confidence == 'VALUE' else 'var(--cyan)') %}
            <span class="px-2.5 py-1 rounded-md text-xs font-heading font-bold uppercase tracking-wider" style="background: {{ badge_color }}20; color: {{ badge_color }}; border: 1px solid {{ badge_color }}40;">
                {{ primary_play.confidence }}
            </span>
        </div>

        {# Model vs Market Bars #}
        <div class="space-y-2 mb-3">
            <div>
                <div class="flex items-center justify-between text-xs mb-1">
                    <span class="font-heading font-semibold" style="color: var(--text-muted);">Model</span>
                    <span class="font-heading font-bold" style="color: var(--magenta);">{{ primary_play.model_prob }}%</span>
                </div>
                <div class="w-full h-2 rounded-full" style="background: rgba(255,255,255,0.06);">
                    <div class="h-full rounded-full" style="width: {{ [primary_play.model_prob, 100]|min }}%; background: var(--gradient-sunset);"></div>
                </div>
            </div>
            <div>
                <div class="flex items-center justify-between text-xs mb-1">
                    <span class="font-heading font-semibold" style="color: var(--text-muted);">Market</span>
                    <span class="font-heading font-bold" style="color: var(--text-secondary);">{{ primary_play.market_implied }}%</span>
                </div>
                <div class="w-full h-2 rounded-full" style="background: rgba(255,255,255,0.06);">
                    <div class="h-full rounded-full" style="width: {{ [primary_play.market_implied, 100]|min }}%; background: rgba(255,255,255,0.2);"></div>
                </div>
            </div>
        </div>

        {# Edge #}
        <div class="flex items-center justify-between">
            <span class="text-sm font-heading font-bold" style="color: {% if primary_play.edge_pct >= 5 %}#4ade80{% else %}var(--text-secondary){% endif %};">
                Edge: {{ '%+.1f'|format(primary_play.edge_pct) }}%
            </span>
            <a href="/tips/{{ primary_play.meeting_id }}" class="text-xs font-heading font-semibold uppercase tracking-wider transition-colors" style="color: var(--cyan);">
                View Full Card &rarr;
            </a>
        </div>
    </div>

    {# Other picks #}
    {% if next_race_picks|length > 1 %}
    <div class="flex flex-wrap gap-2">
        {% for p in next_race_picks if not p.is_puntys_pick and p != primary_play %}
        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-heading font-semibold" style="background: rgba(255,255,255,0.04); border: 1px solid var(--border-subtle); color: var(--text-secondary);">
            #{{ p.saddlecloth }} {{ p.name }} ${{ '%.2f'|format(p.odds) if p.odds else '?' }}
        </span>
        {% endfor %}
    </div>
    {% endif %}
</div>

{% elif next_race and next_race.has_next %}
{# No strong play but racing coming #}
<div class="card p-6 text-center" style="border-color: var(--border-subtle);">
    <div class="text-xs font-heading font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Live Edge Zone</div>
    <p class="font-heading font-semibold text-white mb-2">No Strong Play Right Now</p>
    <p class="text-sm mb-3" style="color: var(--text-secondary);">
        {{ next_race.venue }} R{{ next_race.race_number }} jumping in
        <span class="countdown-fixed font-heading font-bold" style="color: var(--magenta);" data-start="{{ next_race.start_time_iso }}">--:--</span>
    </p>
</div>

{% else %}
{# No racing / all done #}
<div class="card p-6 text-center" style="border-color: var(--border-subtle);">
    <div class="text-xs font-heading font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Live Edge Zone</div>
    <div class="text-3xl mb-2">&#x1F3C7;</div>
    <p class="font-heading font-semibold text-white mb-1">All Done For Today</p>
    <p class="text-sm" style="color: var(--text-secondary);">Check back tomorrow for Punty's next plays.</p>
</div>
{% endif %}

<style>
@keyframes live-dot { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
</style>
